<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link href="/libs/css/bootstrap.min.css" rel="stylesheet" />
    <title>fishMatchConfig</title>
</head>

<body>
    <div class="container">
        <form>
            <h3>鱼</h3>
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th>等级</th>
                        <th>名称</th>
                        <th>图片url</th>
                        <th>价值(分)</th>
                        <th>各阵营初始数量</th>
                        <th>初始钓回概率(%)</th>
                        <th>钓回失败后增加概率(%)</th>
                        <th>钓中后跑马灯广播</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><b>lv1</b></td>
                        <td id="fishName1" contenteditable="true">普通小丑鱼</td>
                        <td id="fishUrl1" class="inputUrl" aria-readonly="true"></td>
                        <td id="fishCost1" contenteditable="true">1</td>
                        <td id="fishStock1" contenteditable="true">100</td>
                        <td id="fishRatio1" contenteditable="true">100</td>
                        <td id="fishHighRatio1" contenteditable="true">0</td>
                        <td>
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="fishBroadcast1">
                                <label class="custom-control-label" for="fishBroadcast1">Broadcast</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><b>lv2</b></td>
                        <td id="fishName2" contenteditable="true">普通胖头鱼</td>
                        <td id="fishUrl2" class="inputUrl" aria-readonly="true"></td>
                        <td id="fishCost2" contenteditable="true">10</td>
                        <td id="fishStock2" contenteditable="true">90</td>
                        <td id="fishRatio2" contenteditable="true">90</td>
                        <td id="fishHighRatio2" contenteditable="true">10</td>
                        <td>
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="fishBroadcast2">
                                <label class="custom-control-label" for="fishBroadcast2">Broadcast</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><b>lv3</b></td>
                        <td id="fishName3" contenteditable="true">普通锦鲤</td>
                        <td id="fishUrl3" class="inputUrl" aria-readonly="true"></td>
                        <td id="fishCost3" contenteditable="true">50</td>
                        <td id="fishStock3" contenteditable="true">80</td>
                        <td id="fishRatio3" contenteditable="true">80</td>
                        <td id="fishHighRatio3" contenteditable="true">9</td>
                        <td>
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="fishBroadcast3">
                                <label class="custom-control-label" for="fishBroadcast3">Broadcast</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><b>lv4</b></td>
                        <td id="fishName4" contenteditable="true">高级小丑鱼</td>
                        <td id="fishUrl4" class="inputUrl" aria-readonly="true"></td>
                        <td id="fishCost4" contenteditable="true">100</td>
                        <td id="fishStock4" contenteditable="true">70</td>
                        <td id="fishRatio4" contenteditable="true">70</td>
                        <td id="fishHighRatio4" contenteditable="true">8</td>
                        <td>
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="fishBroadcast4">
                                <label class="custom-control-label" for="fishBroadcast4">Broadcast</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><b>lv5</b></td>
                        <td id="fishName5" contenteditable="true">高级胖头鱼</td>
                        <td id="fishUrl5" class="inputUrl" aria-readonly="true"></td>
                        <td id="fishCost5" contenteditable="true">200</td>
                        <td id="fishStock5" contenteditable="true">60</td>
                        <td id="fishRatio5" contenteditable="true">60</td>
                        <td id="fishHighRatio5" contenteditable="true">7</td>
                        <td>
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="fishBroadcast5">
                                <label class="custom-control-label" for="fishBroadcast5">Broadcast</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><b>lv6</b></td>
                        <td id="fishName6" contenteditable="true">高级锦鲤</td>
                        <td id="fishUrl6" class="inputUrl" aria-readonly="true"></td>
                        <td id="fishCost6" contenteditable="true">500</td>
                        <td id="fishStock6" contenteditable="true">50</td>
                        <td id="fishRatio6" contenteditable="true">50</td>
                        <td id="fishHighRatio6" contenteditable="true">6</td>
                        <td>
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="fishBroadcast6">
                                <label class="custom-control-label" for="fishBroadcast6">Broadcast</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><b>lv7</b></td>
                        <td id="fishName7" contenteditable="true">顶级小丑鱼</td>
                        <td id="fishUrl7" class="inputUrl" aria-readonly="true"></td>
                        <td id="fishCost7" contenteditable="true">800</td>
                        <td id="fishStock7" contenteditable="true">40</td>
                        <td id="fishRatio7" contenteditable="true">40</td>
                        <td id="fishHighRatio7" contenteditable="true">6</td>
                        <td>
                            <div class="custom-control custom-switch">
                                <input type="checkbox" class="custom-control-input" id="fishBroadcast7">
                                <label class="custom-control-label" for="fishBroadcast7">Broadcast</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><b>lv8</b></td>
                        <td id="fishName8" contenteditable="true">顶级胖头鱼</td>
                        <td id="fishUrl8" class="inputUrl" aria-readonly="true"></td>
                        <td id="fishCost8" contenteditable="true">900</td>
                        <td id="fishStock8" contenteditable="true">30</td>
                        <td id="fishRatio8" contenteditable="true">30</td>
                        <td id="fishHighRatio8" contenteditable="true">5</td>
                        <td>
                            <div class="custom-control custom-switch">
                                <input type="checkbox" checked class="custom-control-input" id="fishBroadcast8">
                                <label class="custom-control-label" for="fishBroadcast8">Broadcast</label>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td><b>lv9</b></td>
                        <td id="fishName9" contenteditable="true">顶级锦鲤</td>
                        <td id="fishUrl9" class="inputUrl" aria-readonly="true"></td>
                        <td id="fishCost9" contenteditable="true">1000</td>
                        <td id="fishStock9" contenteditable="true">10</td>
                        <td id="fishRatio9" contenteditable="true">30</td>
                        <td id="fishHighRatio9" contenteditable="true">5</td>
                        <td>
                            <div class="custom-control custom-switch">
                                <input type="checkbox" checked class="custom-control-input" id="fishBroadcast9">
                                <label class="custom-control-label" for="fishBroadcast9">Broadcast</label>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <h3>礼物</h3>
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th>-</th>
                        <th>id</th>
                        <th>名称</th>
                        <th>价值</th>
                        <th>描述</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><b>钓普通</b></td>
                        <td id="giftId1" contenteditable="true">10001</td>
                        <td id="giftName1" contenteditable="true">初级钓竿</td>
                        <td id="giftCost1" contenteditable="true">9</td>
                        <td id="giftDesc1" contenteditable="true">钓取普通</td>
                    </tr>
                    <tr>
                        <td><b>钓高级</b></td>
                        <td id="giftId2" contenteditable="true">20001</td>
                        <td id="giftName2" contenteditable="true">高级钓竿</td>
                        <td id="giftCost2" contenteditable="true">99</td>
                        <td id="giftDesc2" contenteditable="true">钓取高级</td>
                    </tr>
                    <tr>
                        <td><b>钓顶级</b></td>
                        <td id="giftId3" contenteditable="true">30001</td>
                        <td id="giftName3" contenteditable="true">顶级钓竿</td>
                        <td id="giftCost3" contenteditable="true">999</td>
                        <td id="giftDesc3" contenteditable="true">钓取顶级</td>
                    </tr>
                    <tr>
                        <td><b>钓回</b></td>
                        <td id="giftId4" contenteditable="true">40001</td>
                        <td id="giftName4" contenteditable="true">神奇渔网</td>
                        <td id="giftCost4" contenteditable="true">520</td>
                        <td id="giftDesc4">-</td>
                    </tr>
                </tbody>
            </table>

            <h3>动画资源</h3>
            <table class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th>-</th>
                        <th>lv1</th>
                        <th>lv2</th>
                        <th>lv3</th>
                        <th>lv4</th>
                        <th>lv5</th>
                        <th>lv6</th>
                        <th>lv7</th>
                        <th>lv8</th>
                        <th>lv9</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="resouce1">
                        <td><b>普通</b></td>
                        <td contenteditable="true">0</td>
                        <td contenteditable="true">0</td>
                        <td contenteditable="true">0</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                    <tr id="resouce2">
                        <td><b>高级</b></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true">0</td>
                        <td contenteditable="true">0</td>
                        <td contenteditable="true">0</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                    </tr>
                    <tr id="resouce3">
                        <td><b>顶级</b></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true">0</td>
                        <td contenteditable="true">0</td>
                        <td contenteditable="true">0</td>
                    </tr>
                </tbody>
            </table>

            <h3>活动主页面</h3>
            <textarea id="campaignMainUrl" class="form-control" rows="2" placeholder="Schema..."></textarea>
        </form>
        <hr>

        <button type="button" class="btn btn-primary float-right" onclick="createAndCopyConfig()">
            生成&复制
        </button>
        <br><br>

        <textarea id="jsonConfig" class="form-control" rows="80" readonly></textarea>
    </div>

    <script src="/libs/js/jquery.min.js"></script>
    <script src="/libs/js/popper.min.js"></script>
    <script src="/libs/js/bootstrap.min.js"></script>
    <script src="/libs/js/bootstrap.bundle.min.js"></script>
    <script src="/libs/js/bootbox.min.js"></script>
    <script>
        $(function () {
            $(".inputUrl").click(function () {
                let td = $(this);
                bootbox.prompt({
                    title: "请输入图片url",
                    value: td.val(),
                    callback: function (result) {
                        if (result !== null) {
                            td.val(result);
                            td.text(result.length > 15 ? result.substring(0, 15) + "..." : result);
                        }
                    }
                });
            });
            initConfig();
        })

        function initConfig() {

            let fishDefaultUrl = [
                'https://auto.tancdn.com/v1/raw/4e20b880-4ac6-4c14-a0ea-bf680f3c912308.png',
                'https://auto.tancdn.com/v1/raw/6620d10a-506e-4c0d-99f8-c180d0197a8409.png',
                'https://auto.tancdn.com/v1/raw/08c0c34a-12dc-4120-ba45-86d5d16fd6f708.png',
                'https://auto.tancdn.com/v1/raw/c7010b19-b7cd-4c98-b854-a38770a5005909.png',
                'https://auto.tancdn.com/v1/raw/adb673a0-ee19-4168-be70-0a6f0b84633109.png',
                'https://auto.tancdn.com/v1/raw/0923e76e-20f2-488e-ac59-0eff75624a8208.png',
                'https://auto.tancdn.com/v1/raw/cb2b7b94-0c0c-4429-9cef-667a74ff2bae09.png',
                'https://auto.tancdn.com/v1/raw/a3b6a631-c61a-4acf-9577-9c853457684e08.png',
                'https://auto.tancdn.com/v1/raw/696d1ca6-e5a5-4486-bcf5-3a42e5a2a0ce09.png'
            ];
            for (let i = 1; i <= 9; i++) {
                let url = fishDefaultUrl[i-1];
                $("#fishUrl" + i).val(url);
                $("#fishUrl" + i).text(url.substring(0, 15));
            }

            let data = localStorage.getItem("data");
            if (data == "") {
                return
            }
            let config = JSON.parse(data);
            if (config == null || config.fishMatchConfig == null) {
                return;
            }

            // fish
            if (config.fishMatchConfig.fishConfig != null) {
                for (let i = 1; i <= 9; i++) {
                    let c = config.fishMatchConfig.fishConfig[i - 1];
                    $("#fishName" + i).text(c.name);
                    $("#fishUrl" + i).val(c.url);
                    $("#fishUrl" + i).text(c.url.length > 15 ? c.url.substring(0, 15) + "..." : c.url);
                    $("#fishCost" + i).text(c.cost);
                    $("#fishStock" + i).text(c.stock);
                    $("#fishRatio" + i).text(c.ratio);
                    $("#fishHighRatio" + i).text(c.higherRatio);
                    if (c.broadcast) {
                        $("#fishBroadcast" + i).attr("checked", "true");
                    }
                }
            }

            // gift & resource
            if (config.fishMatchConfig.giftConfig != null) {
                for (let i = 1; i <= 3; i++) {
                    let c = config.fishMatchConfig.giftConfig[i - 1];
                    $("#giftId" + i).text(c.attrId);
                    $("#giftName" + i).text(c.name);
                    $("#giftCost" + i).text(c.cost);
                    $("giftDesc" + i).text(c.desc);
                    let resourceMap = {};
                    for (const key in c.fishMatchRange) {
                        if (Object.hasOwnProperty.call(c.fishMatchRange, key)) {
                            const r = c.fishMatchRange[key];
                            resourceMap[r.level] = r.resourceId;
                        }
                    }
                    const tdList = $("#resouce" + i).children();
                    for (let j = 1; j <= 9; j++) {
                        $(tdList[j]).text(resourceMap[j] !== null ? resourceMap[j] : "");
                    }
                }
            }

            // fishingNet
            if (config.fishMatchConfig.fishingNet != null) {
                $("#giftId4").text(config.fishMatchConfig.fishingNet.attrId);
                $("#giftName4").text(config.fishMatchConfig.fishingNet.name);
                $("#giftCost4").text(config.fishMatchConfig.fishingNet.cost);
            }

            // schame
            if (config.fishMatchConfig.schema != null) {
                $("#campaignMainUrl").val(config.fishMatchConfig.schema);
            }

            // json config
            $("#jsonConfig").text(JSON.stringify(config, null, 8));
        }

        function createAndCopyConfig() {
            // fish
            let fishConfig = [];
            for (let i = 1; i <= 9; i++) {
                let fish = {
                    level: i,
                    name: $("#fishName" + i).text(),
                    url: $("#fishUrl" + i).val(),
                    cost: parseInt($("#fishCost" + i).text()),
                    stock: parseInt($("#fishStock" + i).text()),
                    ratio: parseInt($("#fishRatio" + i).text()),
                    higherRatio: parseInt($("#fishHighRatio" + i).text()),
                };
                if ($("#fishBroadcast" + i).prop('checked')) {
                    fish["noticeMode"] = "broadcast";
                }
                fishConfig.push(fish);
            }
            // gift & resource
            let giftConfig = [];
            for (let i = 1; i <= 3; i++) {
                let fishMatchRange = [];
                let tdList = $("#resouce" + i).children();
                for (let i = 1; i <= 9; i++) {
                    if ($(tdList[i]).text() !== "") {
                        fishMatchRange.push({ level: i, resourceId: parseInt($(tdList[i]).text()) });
                    }
                }
                giftConfig.push({
                    attrId: $("#giftId" + i).text(),
                    name: $("#giftName" + i).text(),
                    cost: parseInt($("#giftCost" + i).text()),
                    desc: $("#giftDesc" + i).text(),
                    fishMatchRange: fishMatchRange
                });
            }
            // net
            let fishingNet = {
                attrId: $("#giftId4").text(),
                name: $("#giftName4").text(),
                cost: parseInt($("#giftCost4").text())
            };

            let data = {
                fishMatchConfig: {
                    fishConfig: fishConfig,
                    giftConfig: giftConfig,
                    fishingNet: fishingNet,
                    schema: $("#campaignMainUrl").val()
                }
            };
            localStorage.setItem("data", JSON.stringify(data));

            // copy
            data.fishMatchConfig.fishConfig.reverse();
            $("#jsonConfig").text(JSON.stringify(data, null, 8));
            $("#jsonConfig").select();
            try {
                if (document.execCommand("copy", false, null)) {
                    alert("复制成功");
                } else {
                    alert("复制失败");
                }
            } catch (e) {
                alert("当前浏览器不支持复制");
            }
        }
    </script>
</body>

</html>